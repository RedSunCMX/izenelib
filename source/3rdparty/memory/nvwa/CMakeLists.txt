MACRO_CHECK_SHOULD_BUILD(nvwa Threads_FOUND)

IF(nvwa_SHOULD_BUILD)

  STRING(TOUPPER "${CMAKE_SYSTEM_NAME}" UPPER_SYSTEM_NAME)
  IF(WIN32)
    SET(nvwa_DEFINITIONS "-DWIN32")
    IF(MINGW)
      SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -D__MINGW__")
    ENDIF(MINGW)
  ELSEIF(UPPER_SYSTEM_NAME STREQUAL "UNIX")
    SET(nvwa_DEFINITIONS "-DUNIX")
  ELSEIF(UPPER_SYSTEM_NAME STREQUAL "LINUX")
    SET(nvwa_DEFINITIONS "-DLINUX")
  ELSE(WIN32)
    SET(nvwa_DEFINITIONS)
  ENDIF(WIN32)

  IF(CMAKE_SYSTEM_PROCESSOR MATCHES "i[0-9]?86")
    SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -DIA32")
  ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "x86_64")
    SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -DAMD64")
  ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "powerpc")
    SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -mcpu=powerpc")
  ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "sparc")
    SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -mcpu=sparc")
  ENDIF(CMAKE_SYSTEM_PROCESSOR MATCHES "i[0-9]?86")

  INCLUDE(TestBigEndian)
  TEST_BIG_ENDIAN(ARCH_IS_BIG_ENDIAN)
  IF(DEFINED ARCH_IS_BIG_ENDIAN)
    IF(ARCH_IS_BIG_ENDIAN)
      SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -DARCH_IS_BIG_ENDIAN=1")
    ELSE(ARCH_IS_BIG_ENDIAN)
      SET(nvwa_DEFINITIONS "${nvwa_DEFINITIONS} -DARCH_IS_BIG_ENDIAN=0")
    ENDIF(ARCH_IS_BIG_ENDIAN)
  ENDIF(DEFINED ARCH_IS_BIG_ENDIAN)

  MESSAGE(STATUS "nvwa_DEFINITIONS=${nvwa_DEFINITIONS}")
  ADD_DEFINITIONS("${nvwa_DEFINITIONS}")
  INCLUDE_DIRECTORIES("${IZENELIB_SOURCE_DIR}/include/3rdparty/memory/")
  SET(nvwa_SRC
    bool_array.cpp
    debug_new.cpp
    mem_pool_base.cpp
    static_mem_pool.cpp
    )

  ADD_LIBRARY(nvwa ${nvwa_SRC})
  TARGET_LINK_LIBRARIES(nvwa ${CMAKE_THREAD_LIBS_INIT})
  #INSTALL(TARGETS nvwa DESTINATION lib)
  INSTALL(TARGETS nvwa     
      LIBRARY DESTINATION lib 
      ARCHIVE DESTINATION lib 
      COMPONENT "izenelib_libraries")

  # we know the warnings, it's ok to alias void* as char*
  IF(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_COMPILER_IS_GNUC)
    SET_TARGET_PROPERTIES(nvwa PROPERTIES
      COMPILE_FLAGS "-Wno-strict-aliasing"
      )
  ENDIF(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_COMPILER_IS_GNUC)

ENDIF(nvwa_SHOULD_BUILD)
