IF(WIN32)
  SET(udt_DEFINITIONS "-DWIN32")
  IF(MINGW)
    SET(udt_DEFINITIONS "${udt_DEFINITIONS} -D__MINGW__")
  ENDIF(MINGW)
ELSEIF(CMAKE_SYSTEM_NAME STREQUAL "UNIX")
  SET(udt_DEFINITIONS "-DUNIX")
ELSEIF(CMAKE_SYSTEM_NAME STREQUAL "LINUX")
  SET(udt_DEFINITIONS "-DLINUX")
ELSE(WIN32)
  SET(udt_DEFINITIONS)
ENDIF(WIN32)

IF(CMAKE_SYSTEM_PROCESSOR MATCHES "i[0-9]?86")
  SET(udt_DEFINITIONS "${udt_DEFINITIONS} -DIA32")
ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "x86_64")
  SET(udt_DEFINITIONS "${udt_DEFINITIONS} -DAMD64")
ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "powerpc")
  SET(udt_DEFINITIONS "${udt_DEFINITIONS} -mcpu=powerpc")
ELSEIF(CMAKE_SYSTEM_PROCESSOR MATCHES "sparc")
  SET(udt_DEFINITIONS "${udt_DEFINITIONS} -mcpu=sparc")
ENDIF(CMAKE_SYSTEM_PROCESSOR MATCHES "i[0-9]?86")

INCLUDE(TestBigEndian)
TEST_BIG_ENDIAN(ARCH_IS_BIG_ENDIAN)
IF(DEFINED ARCH_IS_BIG_ENDIAN)
  IF(ARCH_IS_BIG_ENDIAN)
    SET(udt_DEFINITIONS "${udt_DEFINITIONS} -DARCH_IS_BIG_ENDIAN=1")
  ELSE(ARCH_IS_BIG_ENDIAN)
    SET(udt_DEFINITIONS "${udt_DEFINITIONS} -DARCH_IS_BIG_ENDIAN=0")
  ENDIF(ARCH_IS_BIG_ENDIAN)
ENDIF(DEFINED ARCH_IS_BIG_ENDIAN)
  
MESSAGE(STATUS "udt_DEFINITIONS=${udt_DEFINITIONS}")
ADD_DEFINITIONS("${udt_DEFINITIONS}")

SET_PROPERTY(GLOBAL APPEND PROPERTY BUILD_COMPONENTS udt)

FILE(GLOB_RECURSE udt_SRC
  api.cpp
  buffer.cpp
  cache.cpp
  ccc.cpp
  channel.cpp
  common.cpp
  core.cpp
  list.cpp
  md5.cpp
  packet.cpp
  queue.cpp
  window.cpp
  )

ADD_LIBRARY(udt_shared SHARED ${udt_SRC})
SET_TARGET_PROPERTIES(udt_shared PROPERTIES
  OUTPUT_NAME "udt"
  CLEAN_DIRECT_OUTPUT 1
  VERSION ${IZENELIB_VERSION}
  )

ADD_LIBRARY(udt_static STATIC ${udt_SRC})
SET_TARGET_PROPERTIES(udt_static PROPERTIES
  OUTPUT_NAME "udt"
  CLEAN_DIRECT_OUTPUT 1
  )

INSTALL(TARGETS udt_static udt_shared
  EXPORT udt
  ARCHIVE DESTINATION ${VERSION_INSTALL_PREFIX}/lib
  LIBRARY DESTINATION shared)

INSTALL(EXPORT udt
  DESTINATION ${VERSION_INSTALL_PREFIX}/cmake)

# set( CXXFLAGS "-fPIC -Wall -finline-functions -O3 -DIA32 -DLINUX " )
